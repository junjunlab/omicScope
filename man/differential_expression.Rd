% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/differential-expression.R
\name{differential_expression}
\alias{differential_expression}
\alias{differential_expression,omicscope-method}
\title{Perform differential expression analysis}
\usage{
differential_expression(object, ...)

\S4method{differential_expression}{omicscope}(
  object,
  selectedSample = NULL,
  contrastColumn = "group",
  contrastName = NULL,
  deseq2Design = ~group,
  deseq2Contrast = c("group", "treat", "control"),
  edgerDesign = NULL,
  limmaDesign = NULL,
  limmaApproach = c("voomLmFit", "trend", "voom"),
  log2FCthreshold = 1,
  pvalueThreshold = 0.05,
  method = c("deseq2", "edger", "limma")
)
}
\arguments{
\item{object}{An omicscope object containing count data and sample information.}

\item{...}{Additional arguments (currently not used)}

\item{selectedSample}{Character vector of sample names to include in the analysis.
If NULL (default), all samples are used.}

\item{contrastColumn}{Character string specifying the column name in colData
to use for defining groups in the contrast. Default is "group". This column
will be used to extract group information for edgeR and limma analyses.}

\item{contrastName}{Character string specifying the name for this contrast.
If NULL, defaults to "treat_vs_control"}

\item{deseq2Design}{Formula specifying the design matrix for DESeq2 analysis.
Default is ~group}

\item{deseq2Contrast}{Character vector of length 3 specifying the contrast for DESeq2:
c(factor_name, numerator_level, denominator_level).
Default is c('group', 'treat', 'control')}

\item{edgerDesign}{Design matrix for edgeR analysis. If NULL (default),
uses ~group formula based on colData. Should have rownames matching sample names}

\item{limmaDesign}{Design matrix for limma analysis. If NULL (default),
uses ~group formula based on colData. Should have rownames matching sample names}

\item{limmaApproach}{Character specifying the limma approach to use.
One of "voomLmFit" (default), "trend", or "voom"}

\item{log2FCthreshold}{Numeric value for log2 fold change threshold.
Default is 1 (corresponding to 2-fold change)}

\item{pvalueThreshold}{Numeric value for p-value significance threshold.
Default is 0.05}

\item{method}{Character specifying the differential expression method.
One of "deseq2" (default), "edger", or "limma"}
}
\value{
An omicscope object with differential expression results stored in
the diffExpData slot under the specified method. Results include:
\itemize{
\item Statistical test results (log2FoldChange, pvalue, padj)
\item Gene annotations merged with results
\item Significance classification (sigUp, sigDown, nonSig)
\item Analysis parameters and summary statistics
}
}
\description{
This function performs differential expression analysis using DESeq2, edgeR, or limma-voom
methods. It processes RNA-seq count data and identifies significantly differentially
expressed genes based on specified thresholds.
}
\details{
The function performs the following steps:
\enumerate{
\item Extracts count data and sample metadata from the omicscope object
\item Filters samples if selectedSample is specified
\item Performs differential expression analysis using the selected method:
\itemize{
\item \strong{DESeq2}: DESeqDataSetFromMatrix -> DESeq -> results pipeline
\item \strong{edgeR}: DGEList -> filtering -> normalization -> glmQLFit -> glmQLFTest
\item \strong{limma}: DGEList -> normalization -> voom/trend -> lmFit -> eBayes
}
\item Merges results with gene annotations from rowData
\item Classifies genes based on significance thresholds
\item Stores results in a diffdata object within the omicscope object
}

For \strong{limma analysis}, three approaches are available:
\itemize{
\item \code{voomLmFit}: Uses edgeR::voomLmFit with sample weights (recommended)
\item \code{voom}: Standard limma::voom transformation
\item \code{trend}: Uses log-CPM with eBayes trend=TRUE
}

For \strong{edgeR and limma}, the function performs:
\itemize{
\item Gene filtering using filterByExpr
\item TMM normalization via calcNormFactors
\item Robust dispersion estimation (edgeR only)
\item Quasi-likelihood F-tests (edgeR) or empirical Bayes (limma)
}

The significance classification is based on:
\itemize{
\item \code{sigUp}: log2FoldChange >= log2FCthreshold AND pvalue < pvalueThreshold
\item \code{sigDown}: log2FoldChange <= -log2FCthreshold AND pvalue < pvalueThreshold
\item \code{nonSig}: All other genes
}
}
\note{
\itemize{
\item The function requires 'counts' assay to be present in the omicscope object
\item Sample filtering is based on the 'sample_name' column in colData
\item All character columns in colData are automatically converted to factors
\item For custom design matrices, ensure rownames match sample names after filtering
}
}
\examples{
\dontrun{
# Basic DESeq2 analysis with default parameters
os <- differential_expression(os)

# edgeR analysis with custom contrast name and thresholds
os <- differential_expression(os,
                             method = "edger",
                             contrastName = "treatment_vs_control",
                             log2FCthreshold = 1.5,
                             pvalueThreshold = 0.01)

# DESeq2 analysis with specific samples and contrast
os <- differential_expression(os,
                             method = "deseq2",
                             selectedSample = c("day0-rep1", "day0-rep2",
                                              "day10-rep1", "day10-rep2"),
                             deseq2Contrast = c('group', 'day10', 'day0'))

# edgeR with custom design matrix
group <- factor(c("control", "control", "treated", "treated"))
custom_design <- model.matrix(~group)
os <- differential_expression(os,
                             method = "edger",
                             edgerDesign = custom_design)

# limma-voom analysis
os <- differential_expression(os,
                             method = "limma",
                             limmaApproach = "voom",
                             contrastName = "day10_vs_day0")

# Access results
diff_results <- os@diffExpData$deseq2$treat_vs_control@data
}



}
