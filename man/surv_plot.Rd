% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/visualization.R
\docType{methods}
\name{surv_plot}
\alias{surv_plot}
\alias{surv_plot,omicscope-method}
\title{Create Survival Plots for Selected Genes}
\usage{
surv_plot(object, ...)

\S4method{surv_plot}{omicscope}(
  object,
  selected_gene = NULL,
  add_confidence_interval = TRUE,
  add_risk_table = FALSE,
  curve_col = c("red", "black"),
  ncol = NULL,
  nrow = NULL,
  cut_point = c("auto", "median")
)
}
\arguments{
\item{object}{An \code{omicscope} object containing normalized expression data
and survival information (OS.time and OS columns required in colData)}

\item{...}{Additional arguments (currently not used)}

\item{selected_gene}{Character vector of gene names to analyze. Gene names
must match those in the normalized data. This parameter is required.}

\item{add_confidence_interval}{Logical indicating whether to add confidence
intervals to survival curves. Default is TRUE.}

\item{add_risk_table}{Logical indicating whether to add a risk table below
the survival plot. Default is FALSE. When TRUE, displays both number at
risk and cumulative events.}

\item{curve_col}{Character vector of length 2 specifying colors for high
and low expression groups. Default is c("red", "black").}

\item{ncol}{Integer specifying number of columns for multi-plot layout when
multiple genes are analyzed. Default is NULL (automatic layout).}

\item{nrow}{Integer specifying number of rows for multi-plot layout when
multiple genes are analyzed. Default is NULL (automatic layout).}

\item{cut_point}{Character string specifying the method for determining
expression cutpoint. Options are "auto" (optimal cutpoint using
\code{surv_cutpoint}) or "median" (median expression value). Default is "auto".}
}
\value{
A ggplot object (single gene) or combined plot grid (multiple genes)
showing Kaplan-Meier survival curves with log-rank test p-values.
}
\description{
This method generates Kaplan-Meier survival plots for selected genes using
expression data from an \code{omicscope} object. The function performs
optimal cutpoint analysis or median-based stratification to divide samples
into high and low expression groups, then creates survival curves with
statistical comparisons.
}
\details{
The function performs comprehensive survival analysis workflow:

\subsection{Data Preprocessing}{
\itemize{
\item Filters metadata to tumor samples only
\item Removes samples with missing survival data (OS.time, OS)
\item Extracts normalized expression data for selected genes
\item Joins expression and survival data
}
}

\subsection{Cutpoint Determination}{
\itemize{
\item \strong{Auto mode}: Uses \code{survminer::surv_cutpoint()} to find
the optimal expression threshold that maximally separates survival outcomes
\item \strong{Median mode}: Uses median expression as the cutpoint
\item Classifies samples as "Gene-high" or "Gene-low" based on cutpoint
}
}

\subsection{Statistical Analysis}{
\itemize{
\item Performs log-rank test to compare survival between groups
\item Converts survival time from days to months (divides by 30)
\item Fits Kaplan-Meier survival curves using \code{survfit2()}
}
}

\subsection{Visualization Features}{
\itemize{
\item Publication-ready survival curves with customizable colors
\item Optional confidence intervals with transparency
\item Log-rank p-value annotation in top-right corner
\item Optional risk table showing n.risk and cumulative events
\item Multi-gene plots arranged in customizable grid layout
}
}
}
\section{Required Data Structure}{

The \code{omicscope} object must contain:
\itemize{
\item \strong{Normalized expression data}: Available via \code{@normalizedData} slot
\item \strong{Survival data}: \code{OS.time} and \code{OS} columns in \code{colData}
\item \strong{Sample groups}: \code{group} column with "tumor" samples
\item \strong{Gene annotation}: Gene names must match \code{selected_gene} parameter
}
}

\examples{
\dontrun{
# Single gene analysis with default settings
surv_plot(obj, selected_gene = "TP53")

# Multiple genes with confidence intervals
surv_plot(obj,
          selected_gene = c("METTL5", "METTL16"),
          add_confidence_interval = TRUE)

# Custom visualization options
surv_plot(obj,
          selected_gene = c("EGFR", "KRAS", "ALK", "ROS1"),
          add_confidence_interval = FALSE,
          add_risk_table = TRUE,
          curve_col = c("blue", "orange"),
          ncol = 2, nrow = 2,
          cut_point = "median")

# Publication-ready plot with risk table
surv_plot(obj,
          selected_gene = "PD1",
          add_confidence_interval = TRUE,
          add_risk_table = TRUE,
          curve_col = c("#E31A1C", "#1F78B4"))
}




}
