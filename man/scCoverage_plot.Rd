% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/visualization-single-cell-supps.R
\name{scCoverage_plot}
\alias{scCoverage_plot}
\title{Plot Single-Cell Coverage Tracks with Gene Annotations}
\usage{
scCoverage_plot(
  object = NULL,
  gtf_file = NULL,
  links_data = NULL,
  peaks_data = NULL,
  peaks_width = 3,
  target_gene = NULL,
  target_region = NULL,
  SingleCoveragePlot2_params = list(),
  sample_col = scale_fill_discrete(),
  peaks_sample_col = scale_color_discrete(),
  links_col = scale_color_gradient(),
  extend_up = 2000,
  extend_down = 2000,
  sample_order = NULL,
  group_order = NULL,
  gene_order = NULL,
  region_order = NULL,
  links_sample_order = NULL,
  links_col_var = "score",
  merge_group = FALSE,
  add_range_label = FALSE,
  range_digit = 0,
  remove_labelY = FALSE,
  collapse_exon = FALSE,
  show_utr = TRUE,
  arrow_length = 1.2,
  arrow_linewidth = 0.3,
  arrow_col = "black",
  range_pos = c(0.9, 0.9),
  exon_col = "black",
  exon_linewidth = 3,
  add_backsqure = TRUE,
  add_gene_label = TRUE,
  gene_label_size = 1,
  gene_label_aes = "gene_name",
  highlight_region = NULL,
  highlight_col_aes = "seqnames",
  highlight_col = NULL,
  highlight_alpha = 0.2
)
}
\arguments{
\item{object}{A single-cell object from which to pull coverage data (e.g., a Seurat object
with an Assay containing fragment file information).}

\item{gtf_file}{A \code{GRanges} object or a character string specifying the path to a
GTF/GFF file for gene annotations.}

\item{links_data}{An optional \code{data.frame} for plotting genomic interaction links
(e.g., from Hi-C or Cicero). It must contain at least \code{seqnames}, \code{start}, \code{end},
and \code{sample} columns. \strong{Crucially, if plotting is faceted by gene or region
(i.e., using the \code{target_gene} or \code{target_region} arguments), this data frame
must also include a corresponding column (\code{gene_name} or \code{target_region})
with values matching the targets to ensure links are mapped to the correct plot panel.}}

\item{peaks_data}{An optional \code{data.frame} for plotting genomic peaks (e.g., from
MACS2). If provided, it must contain at least the following columns: \code{seqnames},
\code{start}, \code{end}, \code{sample_name}, and \code{sample}. The \code{sample} column is used to
group all peaks into a single dedicated track and its value must be set to \code{"Peaks"}.
\strong{Crucially, if plotting is faceted by gene or region (using \code{target_gene} or
\code{target_region}), this data frame must also include a corresponding column
(\code{gene_name} or \code{target_region}) with values matching the targets to ensure
peaks are mapped to the correct plot panel.} If \code{NULL} (the default), peaks are
fetched automatically from the provided single-cell \code{object}.}

\item{peaks_width}{Numeric. The linewidth aesthetics for drawing peaks. Default is 3.}

\item{target_gene}{A character vector of gene names to plot. The function will
determine the genomic coordinates automatically from the \code{gtf_file}.}

\item{target_region}{A character vector of genomic regions to plot, formatted as
"chr:start-end" (e.g., "chr1:1000-2000").}

\item{SingleCoveragePlot2_params}{A list of additional parameters passed to the
internal coverage fetching function (e.g., \code{Signac::SingleCoveragePlot}).}

\item{sample_col}{A \code{ggplot2} scale object (e.g., \code{scale_fill_manual}) for coloring
the coverage tracks. Defaults to \code{scale_fill_discrete()}.}

\item{peaks_sample_col}{A \code{ggplot2} scale object (e.g., \code{scale_color_manual}) for
coloring the peak tracks by sample. Defaults to \code{scale_color_discrete()}.}

\item{links_col}{A \code{ggplot2} scale object (e.g., \code{scale_color_gradient}) for
coloring the interaction links. Defaults to a gradient.}

\item{extend_up}{Numeric. Number of base pairs to extend the plotting region
upstream of the gene/region bounds. Default is 2000.}

\item{extend_down}{Numeric. Number of base pairs to extend the plotting region
downstream. Default is 2000.}

\item{sample_order, group_order, gene_order, region_order, links_sample_order}{Character
vectors specifying the desired order of items in the plot facets. If \code{NULL},
default ordering is used.}

\item{links_col_var}{Character. The name of the column in \code{links_data} to use for
coloring the links (e.g., "score", "pvalue"). Default is "score".}

\item{merge_group}{Logical. If \code{TRUE}, coverage signals from samples within the same
group are averaged, and one track per group is shown. Default is \code{FALSE}.}

\item{add_range_label}{Logical. If \code{TRUE}, adds a text label indicating the
y-axis range (e.g., \verb{[0-10]}) for each coverage track. Default is \code{FALSE}.}

\item{range_digit}{Integer. The number of decimal places to round the range label to.
Default is 0.}

\item{remove_labelY}{Logical. If \code{TRUE}, remove y-axis text and ticks for a cleaner plot.
Default is \code{FALSE}.}

\item{collapse_exon}{Logical. If \code{TRUE}, all transcripts for a given gene are
collapsed into a single, representative gene model. Default is \code{FALSE}.}

\item{show_utr}{Logical. If \code{TRUE}, UTRs and CDS regions are drawn with different
thicknesses. If \code{FALSE}, all exonic parts are drawn with the same thickness.
Default is \code{TRUE}.}

\item{arrow_length, arrow_linewidth, arrow_col}{Aesthetics for the arrows on the
gene models indicating transcription direction. Passed to \code{ggarrow::geom_arrow_segment}.}

\item{range_pos}{A numeric vector of length 2, \code{c(x, y)}, specifying the position of
the range label in normalized plot coordinates (from 0 to 1). Default is \code{c(0.9, 0.9)}.}

\item{exon_col, exon_linewidth}{Aesthetics for the exons in the gene models.}

\item{add_backsqure}{Logical. If \code{TRUE}, use \code{geom_label} for gene names (with a
background box); if \code{FALSE}, use \code{geom_text}. Default is \code{TRUE}.}

\item{add_gene_label}{Logical. If \code{TRUE}, adds gene name labels to the gene structure
track when using \code{target_region}. Defaults to \code{TRUE}.}

\item{gene_label_size}{Numeric. The size of the gene name labels. Defaults to 1.}

\item{gene_label_aes}{Character. Column name to use from GTF for gene labeling (like "gene_name", "gene_id").
Defaults to "gene_name".}

\item{highlight_region}{An optional \code{data.frame} with \code{seqnames}, \code{start}, \code{end}
columns to add a shaded background highlighting specific genomic regions.}

\item{highlight_col_aes}{Character. The column name in \code{highlight_region} to map to the
fill color. Default is "seqnames".}

\item{highlight_col}{A named vector or \code{ggplot2} scale to control the fill colors
of the highlighted regions.}

\item{highlight_alpha}{Numeric. The alpha transparency for the highlighted regions.
Default is 0.2.}
}
\value{
A \code{ggplot} object.
}
\description{
This function generates a composite plot displaying single-cell coverage tracks
(e.g., from scATAC-seq) for specified genomic regions or genes.
It integrates gene/transcript structures from a GTF file and can optionally
overlay other genomic features like peaks and interaction links. The plot is
highly customizable, using \code{ggplot2} and \code{ggh4x} for faceting.
}
\details{
The function fetches coverage data using an internal helper function
(conceptually similar to \code{Signac::CoveragePlot}) and processes a GTF file to
draw gene models. It aligns these tracks, allowing for comparison across
different samples, groups, or genomic loci.

Either \code{target_gene} or \code{target_region} must be specified, but not both.
}
\examples{
\dontrun{
# Assuming 'pbmc' is a Seurat object with a scATAC-seq assay, and
# 'hm' is a GRanges object loaded from a GTF file.
hm <- rtracklayer::import.gff("gencode.v49.annotation.gtf.gz")

# Example 1: Plot coverage for a single gene
scCoverage_plot(object = pbmc,
                gtf_file = hm,
                target_gene = "CD8A")

# Example 2: Plot coverage for a specific genomic region
scCoverage_plot(object = pbmc,
                gtf_file = hm,
                target_region = "chr2:86784605-86808396")

# Example 3: Plot multiple genes, collapse exons, and customize labels
scCoverage_plot(object = pbmc,
                gtf_file = hm,
                target_gene = c('MS4A1', 'CD3D', 'LEF1'),
                add_range_label = TRUE,
                remove_labelY = TRUE,
                range_pos = c(0.9, 0.8),
                collapse_exon = TRUE) +
  theme(panel.spacing.y = unit(0, "mm"))

# Example 4: Add custom peaks and interaction links data
# First, create some dummy data for demonstration
gfl <- dplyr::filter(as.data.frame(hm), gene_name == "CD8A" & type == "gene")
links <- data.frame(
  seqnames = gfl$seqnames[1],
  start = sample(gfl$start:gfl$end, 20, replace = TRUE),
  end = sample(gfl$start:gfl$end, 20, replace = TRUE),
  score = runif(20),
  sample = rep(c("links-1", "links-2"), 10)
)
links <- dplyr::filter(links, end > start)

peaks <- data.frame(
  seqnames = gfl$seqnames[1],
  start = sample(gfl$start:gfl$end, 20, replace = TRUE),
  end = sample(gfl$start:gfl$end, 20, replace = TRUE),
  sample_name = rep(c("peaks-1", "peaks-2"), 10),
  sample = "Peaks" # A general category for the track
)
peaks <- dplyr::filter(peaks, end > start)

scCoverage_plot(object = pbmc,
                gtf_file = hm,
                target_gene = "CD8A",
                links_data = links,
                peaks_data = peaks)
}


}
